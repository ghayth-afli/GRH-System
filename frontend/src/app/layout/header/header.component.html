<div class="header">
  <div class="header-content">
    <div class="employee-info">
      <div class="avatar-container">
        <img
          [src]="imageSrc || 'assets/images/nopicture.png'"
          alt="Employee Avatar"
          class="avatar"
        />
      </div>
      <div class="employee-details">
        <div class="name">{{ user.firstName }} {{ user.lastName }}</div>
        <div class="post">
          <div class="job-and-edit-container">
            <div class="job-title">{{ user.jobTitle }}</div>
            <div class="edit-info">
              <button class="edit-info-btn" (click)="openEditModal()">
                Edit Info
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    @if (isEmployee()) {
    <div class="header-leave-balances">
      @if (leaveBalance$ | async; as leaveBalance) {
      <div class="leave-balance">
        <div class="balance">Remaining balance:</div>
        <div class="days">
          {{ leaveBalance.remainingLeave }}/{{ leaveBalance.totalLeave }}
        </div>
      </div>
      }
    </div>
    }

    <div class="notification-container">
      <div class="notification-icon" (click)="toggleDropdown()">
        <i class="icofont-notification"></i>
        @if ((notificationService.unreadCount$ | async) ?? 0 > 0) {
        <span class="notification-badge">
          {{ notificationService.unreadCount$ | async }}
        </span>
        }
      </div>
      @if (isDropdownOpen) {
      <div class="notification-dropdown">
        <div class="notification-header">
          <h5>Notifications</h5>
          <div class="notification-count">
            {{ (notificationService.unreadCount$ | async) ?? 0 }}
          </div>
          @if ((notificationService.unreadCount$ | async) ?? 0 > 0) {
          <!--<button
            class="mark-all-read"
            (click)="notificationService.markAllAsRead().subscribe()"
          >
            Mark all as read
          </button>-->
          }
        </div>

        @for (notification of notificationService.notifications$ | async; track
        notification.id) {
        <div
          class="notification-item"
          [class.unread]="!notification.read"
          (click)="
            !notification.read &&
              notificationService.markAsRead(notification.id).subscribe()
          "
        >
          <div class="notification-icon-img">
            <i
              class="icofont"
              [ngClass]="{
                'icofont-info-circle': notification.type === 'INFO',
                'icofont-warning-alt': notification.type === 'WARNING',
                'icofont-check-circled': notification.type === 'SUCCESS'
              }"
            ></i>
          </div>
          <div class="notification-content">
            <div class="notification-meta">
              <div class="notification-title">{{ notification.title }}</div>
              <div class="notification-time">
                {{ notification.createdAt | timeAgo }}
              </div>
            </div>
            <div class="notification-message">{{ notification.message }}</div>
          </div>
          <div class="notification-status">
            @if (!notification.read) {
            <span class="unread-dot"></span>
            }
          </div>
        </div>
        } @empty {
        <div class="no-notifications">No new notifications</div>
        }
      </div>
      }
    </div>
  </div>
</div>
