<div class="dialog-container">
  <h2 class="dialog-title">Edit Profile</h2>
  @if (userHasNullAttributes) {
  <div class="alert-container">
    <div class="alert alert-warning">
      <div class="alert-icon">
        <i class="icofont-warning-alt"></i>
        <!-- Fallback: <i class="fa-solid fa-exclamation-circle"></i> -->
      </div>
      <div class="alert-content">
        <div class="alert-title">Complete Your Profile</div>
        <div class="alert-message">
          Please complete your personal information to ensure full access to all
          features.
        </div>
      </div>
    </div>
  </div>
  }

  <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
    <div class="profile-picture-container">
      <img
        [src]="user.profilePicture || '/assets/images/nopicture.png'"
        alt="Profile Picture Preview"
        class="profile-picture-preview"
      />
      <div>
        <button
          type="button"
          class="upload-btn"
          (click)="triggerFileInput()"
          aria-label="Upload profile picture"
        >
          Upload Photo
        </button>
        <input
          id="profilePicture"
          type="file"
          accept="image/*"
          class="form-control"
          style="display: none"
          (change)="onFileChange($event)"
          aria-label="Profile picture upload"
        />
      </div>
    </div>
    <div class="form-grid">
      <div class="form-group">
        <label class="form-label" for="firstName">First Name *</label>
        <input
          id="firstName"
          type="text"
          class="form-control"
          formControlName="firstName"
          aria-label="First name"
          [attr.aria-describedby]="
            editForm.get('firstName')?.errors ? 'firstName-error' : null
          "
        />
        <span
          class="form-error"
          id="firstName-error"
          *ngIf="
            editForm.get('firstName')?.errors &&
            editForm.get('firstName')?.touched
          "
        >
          First Name is required
        </span>
      </div>
      <div class="form-group">
        <label class="form-label" for="lastName">Last Name *</label>
        <input
          id="lastName"
          type="text"
          class="form-control"
          formControlName="lastName"
          aria-label="Last name"
          [attr.aria-describedby]="
            editForm.get('lastName')?.errors ? 'lastName-error' : null
          "
        />
        <span
          class="form-error"
          id="lastName-error"
          *ngIf="
            editForm.get('lastName')?.errors &&
            editForm.get('lastName')?.touched
          "
        >
          Last Name is required
        </span>
      </div>
      <div class="form-group">
        <label class="form-label" for="email">Email *</label>
        <input
          id="email"
          type="email"
          class="form-control"
          formControlName="email"
          aria-label="Email"
          [attr.aria-describedby]="
            editForm.get('email')?.errors ? 'email-error' : null
          "
        />
        <span
          class="form-error"
          id="email-error"
          *ngIf="
            editForm.get('email')?.errors && editForm.get('email')?.touched
          "
        >
          <span *ngIf="editForm.get('email')?.errors?.['required']"
            >Email is required</span
          >
          <span *ngIf="editForm.get('email')?.errors?.['email']"
            >Invalid email format</span
          >
        </span>
      </div>
      <div class="form-group">
        <label class="form-label" for="jobTitle">Job Title *</label>
        <input
          id="jobTitle"
          type="text"
          class="form-control"
          formControlName="jobTitle"
          aria-label="Job title"
          [attr.aria-describedby]="
            editForm.get('jobTitle')?.errors ? 'jobTitle-error' : null
          "
        />
        <span
          class="form-error"
          id="jobTitle-error"
          *ngIf="
            editForm.get('jobTitle')?.errors &&
            editForm.get('jobTitle')?.touched
          "
        >
          Job Title is required
        </span>
      </div>
      <div class="form-group">
        <label class="form-label" for="phoneNumber1">Phone Number 1 *</label>
        <input
          id="phoneNumber1"
          type="text"
          class="form-control"
          formControlName="phoneNumber1"
          placeholder="+21612345678"
          aria-label="Primary phone number"
          [attr.aria-describedby]="
            editForm.get('phoneNumber1')?.errors ? 'phoneNumber1-error' : null
          "
        />
        <span
          class="form-error"
          id="phoneNumber1-error"
          *ngIf="
            editForm.get('phoneNumber1')?.errors &&
            editForm.get('phoneNumber1')?.touched
          "
        >
          <span *ngIf="editForm.get('phoneNumber1')?.errors?.['required']"
            >Phone Number 1 is required</span
          >
          <span *ngIf="editForm.get('phoneNumber1')?.errors?.['pattern']"
            >Must be a valid Tunisian number (+216 followed by 8 digits)</span
          >
        </span>
      </div>
      <div class="form-group">
        <label class="form-label" for="phoneNumber2">Phone Number 2</label>
        <input
          id="phoneNumber2"
          type="text"
          class="form-control"
          formControlName="phoneNumber2"
          placeholder="+21687654321"
          aria-label="Secondary phone number"
          [attr.aria-describedby]="
            editForm.get('phoneNumber2')?.errors ? 'phoneNumber2-error' : null
          "
        />
        <span
          class="form-error"
          id="phoneNumber2-error"
          *ngIf="editForm.get('phoneNumber2')?.errors?.['pattern'] && editForm.get('phoneNumber2')?.touched"
        >
          Must be a valid Tunisian number (+216 followed by 8 digits)
        </span>
      </div>
    </div>
    <div class="dialog-actions">
      <button
        type="button"
        class="dialog-btn cancel"
        (click)="closeModal()"
        aria-label="Cancel"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="dialog-btn submit"
        [disabled]="editForm.invalid"
        aria-label="Submit profile changes"
      >
        Save
      </button>
    </div>
  </form>
</div>
