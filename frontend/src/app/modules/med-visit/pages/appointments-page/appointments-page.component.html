<div class="appointments-page">
  @if(authService.hasRole("HR")) {
  <div class="visits-actions">
    @if(displayedAppointments) {
    <button
      class="visit-btn export export-pdf"
      (click)="export('pdf')"
      aria-label="Export to PDF"
    >
      <i class="fa-solid fa-file-pdf"></i> Export PDF
    </button>
    <button
      class="visit-btn export export-csv"
      (click)="export('csv')"
      aria-label="Export to Excel"
    >
      <i class="fa-solid fa-file-excel"></i> Export Excel
    </button>
    }
  </div>
  }
  <div class="filter-section">
    <div class="filter-header">
      <h2 class="filter-title">Appointments</h2>
      <div class="search-box">
        <span class="search-icon"><i class="fa-solid fa-search"></i></span>
        <input
          type="text"
          class="search-input"
          placeholder="Search by employee name..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchTermChange()"
          aria-label="Search appointments by employee name"
        />
      </div>
    </div>
  </div>

  <div class="no-data" *ngIf="!appointments.length" aria-live="polite">
    No appointments found.
  </div>
  <div
    class="appointment-card"
    *ngFor="let appointment of displayedAppointments"
  >
    <div class="appointment-info">
      <h3 class="visit-title">{{ appointment.employeeFullName }}</h3>
      <div class="appointment-meta">
        <span><strong>ID:</strong> {{ appointment.id }}</span>
        <span
          ><strong>Time Slot:</strong>
          {{ appointment.timeSlot | date : "MMM d, yyyy, h:mm a" }}</span
        >
        <span><strong>Email:</strong> {{ appointment.employeeEmail }}</span>
      </div>
    </div>
    <span
      class="appointment-status"
      [ngClass]="appointment.status.toLowerCase()"
    >
      {{ appointment.status }}
    </span>
  </div>

  <div class="pagination">
    <div class="pagination-info">
      Showing <b>1-{{ pageSize }}</b> of
      <b>{{ appointments.length }}</b> appointments
    </div>
    <div class="pagination-controls">
      <select
        class="page-size-select"
        [(ngModel)]="pageSize"
        (ngModelChange)="onPageSizeChange()"
      >
        @for (size of pageSizeOptions; track size) {
        <option [value]="size">{{ size }} per page</option>
        }
      </select>
      <button
        class="pagination-btn"
        [class.disabled]="isPrevDisabled()"
        (click)="previousPage()"
      >
        ◀
      </button>

      @for (page of visiblePages; track page; let i = $index) { @if(page !==
      '...') {
      <button
        class="pagination-btn"
        [class.active]="page === pageIndex"
        (click)="goToPage(+page)"
      >
        {{ +page + 1 }}
      </button>
      } @else {
      <button class="pagination-btn" disabled>...</button>
      } }

      <button
        class="pagination-btn"
        [class.disabled]="isNextDisabled()"
        (click)="nextPage()"
      >
        ▶
      </button>
    </div>
  </div>
</div>
