<div class="visits-page">
  @if(authService.hasRole("HR")) {
  <div class="visits-actions">
    <button
      class="visit-btn create"
      (click)="openCreateDialog()"
      aria-label="Create medical visit"
    >
      <i class="fa-solid fa-plus"></i> Create
    </button>
    @if(displayedVisits) {
    <button
      class="visit-btn export export-pdf"
      (click)="export('pdf')"
      aria-label="Export to PDF"
    >
      <i class="fa-solid fa-file-pdf"></i> Export PDF
    </button>
    <button
      class="visit-btn export export-csv"
      (click)="export('csv')"
      aria-label="Export to Excel"
    >
      <i class="fa-solid fa-file-excel"></i> Export Excel
    </button>
    }
  </div>
  }

  <div class="filter-section">
    <div class="filter-header">
      <h2 class="filter-title">Filters</h2>
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input
          type="text"
          class="search-input"
          placeholder="Search by doctor name"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchTermChange()"
        />
      </div>
    </div>
    @if(authService.hasRole("HR")) {
    <div class="filter-controls">
      <div class="filter-group">
        <label class="filter-label">Visit Date:</label>
        <input
          type="date"
          class="filter-date"
          [(ngModel)]="visitDateFilter"
          (ngModelChange)="onVisitDateChange()"
          aria-label="Filter by visit date"
        />
      </div>
    </div>
    }
  </div>

  <div class="no-data" *ngIf="!displayedVisits.length" aria-live="polite">
    No medical visits found.
  </div>
  <div class="visit-card" *ngFor="let visit of displayedVisits">
    <div class="visit-info">
      <h3 class="visit-title">{{ visit.doctorName }}</h3>
      <div class="visit-meta">
        <span><strong>ID:</strong> {{ visit.id }}</span>
        <span
          ><strong>Visit Date:</strong>
          {{ visit.visitDate | date : "dd/MM/yyyy" }}</span
        >
        <span><strong>Start:</strong> {{ visit.startTime }}</span>
        <span><strong>End:</strong> {{ visit.endTime }}</span>
      </div>
    </div>
    <div class="visit-actions">
      @if(authService.hasRole("HR")) {
      <button
        class="action-btn edit"
        (click)="openEditDialog(visit)"
        aria-label="Edit medical visit"
      >
        <i class="fa-solid fa-edit"></i> Edit
      </button>
      <button
        class="action-btn delete"
        (click)="openDeleteConfirmation(visit.id)"
        aria-label="Delete medical visit"
      >
        <i class="fa-solid fa-trash"></i> Delete
      </button>
      <a
        class="action-btn appointments"
        [routerLink]="['/medical-visits', visit.id, 'appointments']"
        aria-label="View appointments"
      >
        <i class="fa-solid fa-calendar-check"></i> Appointments ({{
          visit.numberOfAppointments
        }})
      </a>
      } @if(!visit.didIBookVisit) {
      <button
        class="action-btn take-appointment"
        (click)="openTakeAppointmentDialog(visit)"
        aria-label="Take appointment"
      >
        <i class="fa-solid fa-clock"></i> Take Appointment
      </button>
      }@else {
      <button
        class="action-btn cancel-appointment"
        (click)="onCancelAppointment(visit.id)"
        aria-label="Cancel appointment"
      >
        <i class="fa-solid fa-ban"></i> Cancel Appointment
      </button>

      }
    </div>
  </div>

  <div class="pagination">
    <div class="pagination-info">
      Showing <b>1-{{ pageSize }}</b> of <b>{{ visits.length }}</b> visits
    </div>
    <div class="pagination-controls">
      <select
        class="page-size-select"
        [(ngModel)]="pageSize"
        (ngModelChange)="onPageSizeChange()"
      >
        @for (size of pageSizeOptions; track size) {
        <option [value]="size">{{ size }} per page</option>
        }
      </select>
      <button
        class="pagination-btn"
        [class.disabled]="isPrevDisabled()"
        (click)="previousPage()"
      >
        ‚óÄ
      </button>

      @for (page of visiblePages; track page; let i = $index) { @if(page !==
      '...') {
      <button
        class="pagination-btn"
        [class.active]="page === pageIndex"
        (click)="goToPage(+page)"
      >
        {{ +page + 1 }}
      </button>
      } @else {
      <button class="pagination-btn" disabled>...</button>
      } }

      <button
        class="pagination-btn"
        [class.disabled]="isNextDisabled()"
        (click)="nextPage()"
      >
        ‚ñ∂
      </button>
    </div>
  </div>
</div>
