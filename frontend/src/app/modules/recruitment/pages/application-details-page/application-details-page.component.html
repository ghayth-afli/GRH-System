<div class="detail-view">
  <a
    routerLink="/recruitment/job-offers/{{ jobId }}/applications"
    class="back-btn"
    >‚Üê Back to List</a
  >

  <div class="detail-header" *ngIf="applicationDetails">
    <div class="detail-candidate-info">
      <h2 class="detail-candidate-name">
        {{ applicationDetails.resume.candidateInfo.name | uppercase }}
      </h2>
      <div class="detail-candidate-contact">
        <span>üìß {{ applicationDetails.resume.candidateInfo.email }}</span>
        <span>üì± {{ applicationDetails.resume.candidateInfo.phone }}</span>
      </div>
      <div class="detail-candidate-location">
        üìç {{ applicationDetails.resume.candidateInfo.location.city }},
        {{ applicationDetails.resume.candidateInfo.location.country }}
      </div>
    </div>
    <div class="detail-actions">
      <button class="action-btn btn-primary" (click)="downloadResume()">
        <i class="fa-solid fa-download"></i>
        Download Resume
      </button>
    </div>
  </div>

  <div class="detail-content" *ngIf="applicationDetails">
    <div class="detail-column">
      <div class="detail-section">
        <h3 class="section-title">
          <svg
            class="section-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          Match Analysis
        </h3>
        <div class="score-overview">
          <div class="score-circle">
            <canvas #scoreChart width="160" height="160"></canvas>
            <div class="score-text">{{ formatScorePercentage() }}</div>
          </div>
          <div class="score-label">Match Score</div>
          <div class="score-interpretation">
            {{ applicationDetails.matchResult.interpretation }}
          </div>
        </div>
        <!-- <div class="score-breakdown">
          <h4 class="breakdown-title">Score Breakdown</h4>

          <ng-container
            *ngFor="
              let criteria of applicationDetails.matchResult.adapted_criteria
            "
          >
            <div class="breakdown-item">
              <div>
                <div class="breakdown-label">{{ criteria.name }}</div>
                <div class="progress-bar">
                  <div
                    class="progress-fill"
                    [style.width.%]="
                      getAdaptedCriteriaValue(criteria.name).percentage
                    "
                  ></div>
                </div>
              </div>
              <div class="breakdown-value">
                {{ getAdaptedCriteriaValue(criteria.name).value }}/{{
                  criteria.weight
                }}
              </div>
            </div>
          </ng-container>
        </div> -->

        <div class="flags-section" *ngIf="getRedFlags().length > 0">
          <h4 class="breakdown-title">Red Flags</h4>
          <div class="flag-item" *ngFor="let flag of getRedFlags()">
            <svg
              class="flag-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
              ></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <div class="flag-text">{{ flag }}</div>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h3 class="section-title">
          <svg
            class="section-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
            ></path>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
            <line x1="12" y1="22.08" x2="12" y2="12"></line>
          </svg>
          Role-Specific Insights
        </h3>
        <ul class="insights-list">
          <li
            class="insight-item"
            *ngFor="let insight of getRoleSpecificInsights()"
          >
            <p class="insight-text">{{ insight }}</p>
          </li>
        </ul>
      </div>
    </div>

    <div class="detail-column">
      <div class="detail-section">
        <h3 class="section-title">
          <svg
            class="section-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            ></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
          Resume Overview
        </h3>

        <div class="resume-section">
          <h4 class="resume-section-title">Experience</h4>
          <div
            class="resume-item"
            *ngFor="let exp of applicationDetails.resume.experience"
          >
            <div class="resume-item-title">{{ exp.title }}</div>
            <div class="resume-item-subtitle">{{ exp.company }}</div>
            <div class="resume-item-dates">
              {{ exp.startDate }} - {{ exp.endDate }} | {{ exp.location }}
            </div>
            <ul class="resume-item-list">
              <li *ngFor="let resp of exp.responsibilities">{{ resp }}</li>
            </ul>
          </div>
        </div>

        <div class="resume-section">
          <h4 class="resume-section-title">Education</h4>
          <div
            class="resume-item"
            *ngFor="let edu of applicationDetails.resume.education"
          >
            <div class="resume-item-title">{{ edu.degree }}</div>
            <div class="resume-item-subtitle">{{ edu.institution }}</div>
            <div class="resume-item-dates">
              {{ edu.startDate }} - {{ edu.endDate }} | {{ edu.location }}
            </div>
            <div class="resume-item-description">
              {{ edu.fieldOfStudy }}
            </div>
          </div>
        </div>

        <div class="resume-section">
          <h4 class="resume-section-title">Skills</h4>
          <div class="skills-container">
            <ng-container
              *ngFor="let skill of applicationDetails.resume.skills.technical"
            >
              <span
                class="skill-tag"
                [class.highlight]="
                  applicationDetails.matchResult.details.skills_match.matching_skills.includes(
                    skill
                  )
                "
              >
                {{ skill }}
              </span>
            </ng-container>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h3 class="section-title">
          <svg
            class="section-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          Final Assessment
        </h3>
        <ul class="insights-list">
          <li
            class="insight-item"
            *ngFor="let insight of getRoleSpecificInsights().slice(-2)"
          >
            <p class="insight-text">{{ insight }}</p>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="loading-indicator" *ngIf="!applicationDetails">
    Loading application details...
  </div>
</div>
